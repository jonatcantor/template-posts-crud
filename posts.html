<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Web site about news">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@500&family=Roboto:wght@300&display=swap" rel="stylesheet"> 
  <link rel="stylesheet" href="./css/index.css">
  <title>Template posts - Post | Jonathan Cantor</title>
</head>
<body>
  <header class="header">
    <div class="header__lists">
      <nav>
        <ul class="stick__list">
          <li class="stick__list__element"><a href="./index.html">Home</a></li>
          <li class="stick__list__element"><a href="#">About Us</a></li>
          <li class="stick__list__element"><a href="#">Demo Page</a></li>
          <li class="stick__list__element"><a href="#">Contact Page</a></li>
        </ul>
      </nav>
      
      <nav>
        <ul class="stick__list">
          <li class="stick__text">Subscribe:</li>
          <li class="stick__list__element"><a href="#">Posts</a></li>
          <li class="stick__list__element"><a href="#">Comments</a></li>
          <li class="stick__list__element"><a href="#">Email</a></li>
        </ul>
      </nav>
    </div>

    <div class="header__content">
      <div class="header__logo">
        <h1 class="header__title"><a href="./index.html">Web Site Name</a></h1>
        <span class="header__description"><a href="./index.html">Web Site Description</a></span>
      </div>

      <button onclick="altClassFromSelector('header__lists__open', '.header__lists')" aria-label="Menu button" class="header__button"><svg viewBox="0 0 100 80"><rect width="100" height="20"></rect><rect y="30" width="100" height="20"></rect><rect y="60" width="100" height="20"></rect></svg></button>
    </div>

    <div class="advertise advertise--lg">
      Advertise Here
    </div>
  </header>

  <nav class="tag__list__box">
    <ul class="tag__list">
      <li class="tag__list__element"><a href="#">Advertising</a></li>
      <li class="tag__list__element"><a href="#">Entertainment</a></li>
      <li class="tag__list__element"><a href="#">Fashion</a></li>
      <li class="tag__list__element"><a href="#">Lifestyle</a></li>
      <li class="tag__list__element"><a href="#">Pictures</a></li>
      <li class="tag__list__element"><a href="#">Videos</a></li>
    </ul>
  </nav>

  <div class="wrapper">
    <main class="main main--single">
      <article class="post">
        <div class="post__img post__img__loading"></div>
        <div class="post__title post__title__loading"></div>
        <div class="post__info post__info__loading"></div>
        <div class="post__excerpt post__excerpt__loading"></div>
        <div class="post__link post__link__loading"></div>
      </article>

      <section class="post__comments">
        <h3 class="post__comments__title">Post comments</h3>

        <article class="comment">
          <div class="comment__photo comment__photo__loading"></div>
          <div class="comment__user comment__user__loading"></div>
          <div class="comment__comment comment__comment__loading"></div>
        </article>
      </section>
    </main>

    <aside class="aside">
      <div class="aside__advertise">
        <div class="advertise advertise--sm">
          <spam>Advertise Here!</spam>
          <spam>125x125</spam>
        </div>

        <div class="advertise advertise--sm">
          <spam>Advertise Here!</spam>
          <spam>125x125</spam>
        </div>

        <div class="advertise advertise--sm">
          <spam>Advertise Here!</spam>
          <spam>125x125</spam>
        </div>

        <div class="advertise advertise--sm">
          <spam>Advertise Here!</spam>
          <spam>125x125</spam>
        </div>
      </div>

      <form method="" class="aside__search">
        <input type="search" value="" required name="search" aria-label="Search post" class="aside__input">
        <input type="submit" value="Search" aria-label="Submit button" class="aside__submit">
      </form>

      <section class="aside__section">
        <h3 class="aside__title">Popular Posts</h3>
        <ul class="aside__posts"></ul>
      </section>

      <section class="aside__section">
        <h3 class="aside__title">Flickr Photos</h3>
        <ul class="aside__photos">
          <li><a href="https://picsum.photos/id/500/200" target="_blank" rel="noopener noreferrer"><img src="https://picsum.photos/id/500/200" alt="photo 1" width="200" height="200"></a></li>
          <li><a href="https://picsum.photos/id/501/200" target="_blank" rel="noopener noreferrer"><img src="https://picsum.photos/id/501/200" alt="photo 2" width="200" height="200"></a></li>
          <li><a href="https://picsum.photos/id/502/200" target="_blank" rel="noopener noreferrer"><img src="https://picsum.photos/id/502/200" alt="photo 3" width="200" height="200"></a></li>
          <li><a href="https://picsum.photos/id/503/200" target="_blank" rel="noopener noreferrer"><img src="https://picsum.photos/id/503/200" alt="photo 4" width="200" height="200"></a></li>
          <li><a href="https://picsum.photos/id/504/200" target="_blank" rel="noopener noreferrer"><img src="https://picsum.photos/id/504/200" alt="photo 5" width="200" height="200"></a></li>
          <li><a href="https://picsum.photos/id/505/200" target="_blank" rel="noopener noreferrer"><img src="https://picsum.photos/id/505/200" alt="photo 6" width="200" height="200"></a></li>
        </ul>
      </section>

      <section class="aside__section">
        <h3 class="aside__title">Featured Video</h3>

        <video class="aside__video" autoplay playsinline muted controls loop>
          <source src="./videos/fox.mp4" type="video/mp4">
        </video>
      </section>
    </aside>
  </div>

  <footer class="footer">
    <p>Â© Copyright</p>
  </footer>

  <script src="./js/index.js"></script>
  <script>
    const getPostComments = async (postId) => {
      const response = await fetch('https://jsonplaceholder.typicode.com/posts/' + postId + '/comments', { method: 'GET' });

      if(!response.ok) return { 'error' : response.status };

      const dataJson = await response.json();

      return dataJson;
    }

    const getUrlParameter = (param) => {
      const url = window.location.href;
      let parameters = url.split('?');

      if(parameters.length != 2) return { 'error': 'parameters not found' };
      parameters = parameters[1].split('&');

      if(parameters.length != 1) return { 'error': 'parameters not valids' };

      const parameter = parameters[0].split('=');
      if(parameter[0] != param) return { 'error': 'parameters not valids' };

      return parameter[1];
    }

    const getPost = async (postId) => {
      const response = await fetch('https://jsonplaceholder.typicode.com/posts/' + postId, { method: 'GET' });

      if(!response.ok) return { 'error' : response.status };

      const dataJson = await response.json();

      return dataJson;
    }

    const getPosts = async () => {
      const response = await fetch('https://jsonplaceholder.typicode.com/posts', { method: 'GET' });

      if(!response.ok) return { 'error' : response.status };

      const dataJson = await response.json();

      return dataJson;
    }
    
    (async () => {
      const postId = getUrlParameter('id');

      if(postId.error) return;
      const main = document.querySelector('.main');

      const post = await getPost(postId);

      if(!post.error) {
        main.removeChild(main.firstElementChild);

        const postImgDOM = document.createElement('img');
        postImgDOM.loading = 'lazy';
        postImgDOM.className = 'post__img';
        postImgDOM.srcset = 'https://picsum.photos/id/' + post.id + '/500 500w, https://picsum.photos/id/' + post.id + '/800 800w';
        postImgDOM.sizes = '(min-width: 0px) 480px, (min-width: 768px) 768px, (min-width: 1024px) 1024px';
        postImgDOM.alt = post.title + ' image';

        const postTitleDOM = document.createElement('h2');
        postTitleDOM.className = 'post__title';
        postTitleDOM.textContent = post.title;

        const postDateDOM = document.createElement('p');
        postDateDOM.className = 'post__info';
        postDateDOM.textContent = 'postinfo';

        const postTextDOM = document.createElement('p');
        postTextDOM.className = 'post__excerpt';
        postTextDOM.textContent = post.body;

        const postDOM = document.createElement('article');
        postDOM.className = 'post post__single';
        postDOM.append(postImgDOM);
        postDOM.append(postTitleDOM);
        postDOM.append(postDateDOM);
        postDOM.append(postTextDOM);

        main.prepend(postDOM);
      }

      const postComments = await getPostComments(postId);

      if(!postComments.error) {
        main.removeChild(main.lastElementChild);

        postComments.forEach((comment) => {
          const commentPhotoDOM = document.createElement('img');
          commentPhotoDOM.classList = 'comment__photo';
          commentPhotoDOM.src = 'https://picsum.photos/id/' + (999 + comment.id) + '/100';
          commentPhotoDOM.alt = 'User image';
          
          const commentUserDOM = document.createElement('h4');
          commentUserDOM.classList = 'comment__user';
          commentUserDOM.textContent = comment.name;

          const commentCommentDOM = document.createElement('p');
          commentCommentDOM.classList = 'comment__comment';
          commentCommentDOM.textContent = comment.body;

          const commentDOM = document.createElement('article');
          commentDOM.classList = 'comment';
          commentDOM.append(commentPhotoDOM);
          commentDOM.append(commentUserDOM);
          commentDOM.append(commentCommentDOM);

          main.append(commentDOM);
        });
      }

      const asidePosts = document.querySelector('.aside__posts');

      const posts = await getPosts();

      if(posts.error) return;

      const popularPosts = posts.slice(0, 5);

      popularPosts.forEach((post) => {
        const postLiDOM = document.createElement('li');

        const postLinkDOM = document.createElement('a');
        postLinkDOM.textContent = post.title;
        postLinkDOM.href = './posts.html?id=' + post.id;

        postLiDOM.append(postLinkDOM);

        asidePosts.append(postLiDOM);
      });
    })();
  </script>
</body>
</html>
